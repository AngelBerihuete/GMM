#LyX 2.1 created this file. For more info see http://www.lyx.org/
\lyxformat 474
\begin_document
\begin_header
\textclass article
\use_default_options true
\maintain_unincluded_children false
\language english
\language_package default
\inputencoding auto
\fontencoding global
\font_roman default
\font_sans default
\font_typewriter default
\font_math auto
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize default
\use_hyperref false
\papersize default
\use_geometry false
\use_package amsmath 1
\use_package amssymb 1
\use_package cancel 1
\use_package esint 1
\use_package mathdots 1
\use_package mathtools 1
\use_package mhchem 1
\use_package stackrel 1
\use_package stmaryrd 1
\use_package undertilde 1
\cite_engine basic
\cite_engine_type default
\biblio_style plain
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\justification true
\use_refstyle 1
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Section*
Variational Message Passing (VMP)
\end_layout

\begin_layout Subsection*
Univariate Gaussian Distribution
\end_layout

\begin_layout Standard
Lets define the likelihood for N i.i.d samples each following a uniform distributi
on:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
P(\textbf{x}|\Omega) & =\prod_{n=1}^{N}\mathbb{\mathcal{N}}(x_{n}|\mu,\gamma^{-1})
\end{align*}

\end_inset

where 
\begin_inset Formula $\mu$
\end_inset

 corresponds to the mean parameter and 
\begin_inset Formula $\gamma$
\end_inset

 corresponds to the precision parameter (
\begin_inset Formula $\gamma=\sigma^{-2}$
\end_inset

)
\end_layout

\begin_layout Standard
We rewrite the Normal in exponential family form
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\ln\mathcal{N}(x_{n}|\mu,\gamma^{-1}) & =\left[\begin{array}{cc}
\gamma\mu & -\gamma/2\end{array}\right]\left[\begin{array}{c}
x_{n}\\
x_{n}^{2}
\end{array}\right]+\frac{1}{2}\left(\ln\gamma-\gamma\mu^{2}-\ln2\pi\right)\\
 & =\left[\begin{array}{cc}
\gamma x_{n} & -\gamma/2\end{array}\right]\left[\begin{array}{c}
\mu\\
\mu^{2}
\end{array}\right]+\frac{1}{2}(\ln\gamma-\gamma x_{n}^{2}-\ln2\pi)\\
 & =\left[\begin{array}{cc}
-\frac{1}{2}\left(x_{n}-\mu\right)^{2} & \frac{1}{2}\end{array}\right]\left[\begin{array}{c}
\gamma\\
\ln\gamma
\end{array}\right]-\ln2\pi
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
We impose a Normal prior for the mean parameter and a Gamma prior for the
 precision parameter
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\ln P(\mu|m,\beta) & =\left[\begin{array}{cc}
\beta m & \beta/2\end{array}\right]\left[\begin{array}{c}
\mu\\
\mu^{2}
\end{array}\right]+\frac{\text{1}}{2}\left(\ln\beta-\beta m^{2}-\ln2\pi\right)\\
\ln P(\gamma|a,b) & =\left[\begin{array}{cc}
-b & a-1\end{array}\right]\left[\begin{array}{c}
\gamma\\
ln\gamma
\end{array}\right]+a\ln b-\ln\Gamma(a)
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection*
Variational Approximation
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
Q(\mu,\gamma) & =Q_{\mu}(\mu)Q_{\gamma}(\gamma)
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\ln Q_{\mu}^{*}(\mu) & =\left[\beta m+\mathbb{E}_{q_{\gamma}}\left(\gamma\right)\sum_{n=1}^{N}x_{n}\;\;\ -\beta/2-\mathbb{E}_{q_{\gamma}}\left(\gamma\right)N/2\right]\left[\begin{array}{c}
\mu\\
\mu^{2}
\end{array}\right]+f_{\mu}(\mu)+const\\
\\
\ln Q_{\gamma}^{*}(\gamma) & =\left[\begin{array}{cc}
-b-1/2\sum_{n=1}^{N}(x_{n}^{2}-2x_{n}\mathbb{E}_{q_{\mu}}(\mu)+\mathbb{E}_{q_{\mu}}(\mu^{2}))\;\;\; & a-1-1/2\end{array}\right]\left[\begin{array}{c}
\gamma\\
\ln\gamma
\end{array}\right]+f_{\gamma}(\text{\gamma)+const}
\end{align*}

\end_inset


\end_layout

\begin_layout Standard
Therefore, 
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\ln Q_{\mu}^{*}(\mu) & =\left[\begin{array}{cc}
\beta_{\mu}m_{\mu} & -\beta_{\mu}/2\end{array}\right]\left[\begin{array}{c}
\mu\\
\mu^{2}
\end{array}\right]+\frac{\text{1}}{2}\left(\ln\beta_{\mu}-\beta_{\mu}m_{\mu}^{2}-\ln2\pi\right)\\
\left[\begin{array}{c}
\theta_{1}\\
\theta_{2}
\end{array}\right] & =\left[\begin{array}{c}
\beta_{\mu}m_{\mu}\\
-\beta_{\mu}/2
\end{array}\right]\\
f_{\mu}(\mu) & =\frac{1}{2}\ln2\pi\\
A(m_{\mu},\beta_{\mu}) & =\frac{\text{1}}{2}\left(-\ln\beta_{\mu}+\beta_{\mu}m_{\mu}^{2}\right)\\
A(\theta_{1},\theta_{2}) & =\frac{\text{1}}{2}\left(-\ln(-2\theta_{2})-2\theta_{2}\left(\frac{\theta_{1}}{-2\theta_{2}}\right)^{2}\right)=\frac{\text{1}}{2}\left(-\ln(-2\theta_{2})-\frac{\theta_{1}^{2}}{2\theta_{2}}\right)\\
\nabla A(\theta_{1},\theta_{2}) & =\left[\begin{array}{c}
-\frac{\theta_{1}}{2\theta_{2}}\\
-\frac{1}{2\theta_{2}}+\frac{\theta_{1}^{2}}{4\theta_{2}^{2}}
\end{array}\right]\rightarrow\mathbb{E}_{q_{\mu}}\left(\mathbf{u}(\mu)\right)=\left[\begin{array}{c}
m_{\mu}\\
\frac{1}{\beta_{\mu}}+m_{\mu}^{2}
\end{array}\right]\\
\\
\\
\ln Q_{\gamma}^{*}(\gamma) & =\left[\begin{array}{cc}
-b_{\gamma} & a_{\gamma}-1\end{array}\right]\left[\begin{array}{c}
\gamma\\
\ln\gamma
\end{array}\right]+a_{\gamma}\ln b_{\gamma}-\ln\Gamma(a_{\gamma})\\
\left[\begin{array}{c}
\theta_{1}\\
\theta_{2}
\end{array}\right] & =\left[\begin{array}{c}
-b_{\gamma}\\
a_{\gamma}-1
\end{array}\right]\\
f_{\gamma}(\gamma) & =1\\
A(a_{\gamma},b_{\gamma}) & =-a_{\gamma}\ln b_{\gamma}+\ln\Gamma(a_{\gamma})\\
A(\theta_{1},\theta_{2}) & =-(\theta_{2}+1)\ln(-\theta_{1})+\ln\Gamma(\theta_{2}+1)\\
\nabla A(\theta_{1},\theta_{2}) & =\left[\begin{array}{c}
\frac{-(\theta_{2}+1)}{\theta_{1}}\\
-\ln(-\theta_{1})+\Psi(\theta_{2}+1)
\end{array}\right]\rightarrow\mathbb{E}_{q_{\gamma}}\left(\mathbf{u}(\gamma)\right)=\left[\begin{array}{c}
\frac{a_{\gamma}}{b_{\gamma}}\\
\Psi(a_{\gamma})-\ln(b_{\gamma})
\end{array}\right]
\end{align*}

\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Subsection*
Variational Message Passing
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\textbf{m}_{\gamma\rightarrow x_{n}}=\mathbb{E}_{q_{\gamma}(\gamma|a_{\gamma},b_{\gamma})}\left(\mathbf{u}_{\gamma}(\gamma)\right) & =\left[\begin{array}{c}
\mathbb{E}_{q_{\gamma}}(\gamma)\\
\mathbb{E}_{q_{\gamma}}(\ln\gamma)
\end{array}\right]=\left[\begin{array}{c}
-\frac{\delta g(a_{\gamma}b_{\gamma})}{\delta a_{\gamma}}\\
-\frac{\delta g(a_{\gamma}b_{\gamma})}{\delta b_{\gamma}}
\end{array}\right]=\left[\begin{array}{c}
\frac{a_{\gamma}}{b_{\gamma}}\\
\Psi(a_{\gamma})-\ln(b_{\gamma})
\end{array}\right]^{T}\\
\textbf{m}_{x_{n}\rightarrow\mu}= & \left[\begin{array}{c}
\mathbb{E}_{q_{\gamma}}(\gamma)x_{n}\\
-\mathbb{E}_{q_{\gamma}}(\gamma)/2
\end{array}\right]=\left[\begin{array}{c}
\frac{a_{\gamma}}{b_{\gamma}}x_{n}\\
-\frac{a_{\gamma}}{2b_{\gamma}}
\end{array}\right]\\
\phi_{\mu}^{*}= & \left[\begin{array}{c}
\beta m\\
-\beta/2
\end{array}\right]+\sum_{n=1}^{N}\textbf{m}_{x_{n}\rightarrow\mu}\\
\mathbf{m}_{\mu\rightarrow x_{n}}=\mathbb{E}_{q_{\mu}(\mu|m_{\mu},\beta_{\mu})}\left(\mathbf{u}_{\mu}(\mu)\right)= & \left[\begin{array}{c}
\mathbb{E}_{q_{\mu}}(\mu)\\
\mathbb{E}_{q_{\mu}}(\mu^{2})
\end{array}\right]=\left[\begin{array}{c}
-\frac{\delta g(m_{\mu},\beta_{\mu})}{\delta m_{\mu}}\\
-\frac{\delta g(m_{\mu}\beta_{\mu})}{\delta\beta_{\mu}}
\end{array}\right]=\left[\begin{array}{c}
m_{\mu}\\
\frac{1}{\beta_{\mu}}+m_{\mu}^{2}
\end{array}\right]\\
\mathbf{m}_{x_{n}\rightarrow\gamma}= & \left[\begin{array}{c}
-\frac{1}{2}\left(x_{n}^{2}-2x_{n}\mathbb{E}_{q_{\mu}}(\mu)+\mathbb{E}_{q_{\mu}}(\mu^{2})\right)\\
\frac{1}{2}
\end{array}\right]=\left[\begin{array}{c}
-\frac{1}{2}\left(x_{n}^{2}-2x_{n}m_{\mu}+\frac{1}{\beta_{\mu}}+m_{\mu}^{2}\right)\\
\frac{1}{2}
\end{array}\right]\\
\phi_{\gamma}^{*}= & \left[\begin{array}{c}
-b\\
a-1
\end{array}\right]+\sum_{n=1}^{N}\mathbf{m}_{x_{n}\rightarrow\gamma}
\end{align*}

\end_inset


\end_layout

\begin_layout Subsection*
LowerBound
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{align*}
\mathcal{L}(Q)= & \sum_{i}\mathcal{L}_{i}\\
\mathcal{L}_{x_{n}}= & \left[\begin{array}{c}
\mathbb{E}_{q_{\gamma}}(\gamma)\mathbb{E}_{q_{\mu}}(\mu)\\
-\mathbb{E}_{q_{\gamma}}(\gamma)/2
\end{array}\right]^{T}\left[\begin{array}{c}
x_{n}\\
x_{n}^{2}
\end{array}\right]+\frac{1}{2}\left(\mathbb{E}_{q_{\gamma}}(\ln\gamma)-\mathbb{E}_{q_{\gamma}}(\gamma)\mathbb{E}_{q_{\mu}}(\mu^{2})-\ln2\pi\right)\\
\mathcal{L}_{\mu}= & \left[\begin{array}{c}
\beta m-\beta_{\mu}m_{\mu}\\
-\beta/2+\beta_{\mu}/2
\end{array}\right]^{T}\left[\begin{array}{c}
\mathbb{E}_{q_{\mu}}(\mu)\\
\mathbb{E}_{q_{\mu}}(\mu^{2})
\end{array}\right]+\frac{1}{2}\left(\ln\beta-\beta m^{2}-\ln\beta_{\mu}+\beta_{\mu}m_{\mu}^{2}\right)\\
\mathcal{L_{\gamma}=} & \left[\begin{array}{c}
-b+b_{\gamma}\\
a-a_{\gamma}
\end{array}\right]^{T}\left[\begin{array}{c}
\mathbb{E}_{q_{\gamma}}(\gamma)\\
\mathbb{E}_{q_{\gamma}}(\ln\gamma)
\end{array}\right]+a\log b-\log\Gamma(a)-a_{\gamma}\log b_{\gamma}+\log\Gamma(a_{\gamma})
\end{align*}

\end_inset


\end_layout

\end_body
\end_document
